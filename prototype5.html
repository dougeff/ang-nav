<!DOCTYPE html>
<html ng-app="artNavApp">
	<head>
<!-- 		<base href="/prototype5.html"> -->
		<link rel="stylesheet" href="/css/font-awesome.css" />
  		<link rel="stylesheet" href="/css/themify-icons.css" />
		<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
		<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.3.5/angular.js"></script>
		<script src="//cdn.jsdelivr.net/lodash/3.0/lodash.min.js"></script>
		<script type='text/javascript'>
		(function () {
			'use strict';
			var __startingLevel = 0;
			var __maxLevel = 0;
			var __initializing = true;

			var navApp = angular.module('artNavApp', []);
			var NavListController = function ($scope, $http, $location, $timeout) {
				var self = this;
				var classesByInterest = [];
				self.arrCategory = [];
				self.location = $location;

				var _http = $http;
				_http.get('items/CatProdPkg_SOA.json').then(function (items) {

					_http.get('arc-response_AllClasses.json').then(function (data) {
						classesByInterest.push(data.data[5]);

						self.getValues(classesByInterest, 0);

						self.buildCurrentObj();
					});
				});

				$scope.$watch(function () {
					return self.location.path();
				}, function (){
					if (__initializing) {
						$timeout(function() { __initializing = false; });
					} else {
						var locationPath = self.location.path();
						if (locationPath.length > self.lastLocationPath.length){
							//drill down
							var lastCurrent = _.find(self.activeBreadcrumb, 'Current');
							if (lastCurrent.NodeID === self.currentObj.NodeID){
								//this is when they click the foward button instead of the link
								var lastSubFolder = locationPath.substring(locationPath.lastIndexOf("/")+1, locationPath.length);
								var chkLevel = self.currentObj.Level + 1;
								var foundChild = _.where(self.arrCategory[chkLevel], { 'Name': lastSubFolder, Parent: lastCurrent.NodeID });
								self.drillDown(foundChild[0]);
							}
							lastCurrent.Current = false;
							self.activeBreadcrumb.push(_.clone(self.currentObj));
						}else{
							//back up
							self.activeBreadcrumb.pop();
							var nextCurrent = _.last(self.activeBreadcrumb);
							nextCurrent.Current = true;

							self.currentObj.Level = nextCurrent.Level;
							self.currentObj.Name = nextCurrent.Name;
							self.currentObj.NodeID = nextCurrent.NodeID;
							self.currentObj.Current = nextCurrent.Current;
                        }
                        self.lastLocationPath = locationPath;
					}
				});
			};

			NavListController.prototype.buildCurrentObj = function () {
				var self = this;
				var locationPath = self.location.path();
				if (locationPath.length > 0) {
					self.lastLocationPath = locationPath;
					var subfolders = locationPath.split("/");
					var findChild, foundChildParent, findObj, foundChild;
					self.activeBreadcrumb = [];
					_.forEachRight(subfolders, function (folder, index) {
						if (folder.length > 0) {
							if (_.isUndefined(foundChildParent)){
								if (index === 1){
									//if this is only one level above then we can safely assume there are no duplicate children
									findObj = { 'Name': folder };
								}else{
									//this is to safeguard against multiple children of the same name
									var findAllPossibleChildren = _.where(self.arrCategory[index], { 'Name': folder });
									var findAllPossibleParents = _.where(self.arrCategory[index-1], { 'Name': subfolders[index-1] });
									_.forEach(findAllPossibleChildren, function (kids, index) {
										var parentId = kids.Parent;
										var foundParent = _.where(findAllPossibleParents, { NodeID: parentId });
										if (foundParent.length > 0){
											foundChildParent = foundParent[0].NodeID;
											return false;
										}
									});
									findObj = { 'Name': folder, Parent: foundChildParent };
								}
							}else{
								findObj = { 'Name': folder, NodeID: foundChildParent };
							}
							findChild = _.where(self.arrCategory[index], findObj);
							foundChild = findChild[0];
							foundChildParent = foundChild.Parent;

							if (index === (subfolders.length - 1)){
								foundChild.Current = true;
								self.currentObj = _.clone(foundChild);
							}	
						}else{
							foundChild = {
								Level: 0,
								Name: 'School of the Arts',
								NodeID: 3446,
								Current: true
							};
						}
						self.activeBreadcrumb.push(_.clone(foundChild));
					});
					self.activeBreadcrumb.reverse();
				}else{
					self.currentObj = {
						Level: 0,
						Name: 'School of the Arts',
						NodeID: 3446,
						Current: true
					};
					self.activeBreadcrumb = [ _.clone(self.currentObj) ];
					self.lastLocationPath = '';
				}
			};

			NavListController.prototype.setUrl = function () {
				var self = this;
				var location = self.location;
				var locationPath = location.path();
				location.path(locationPath + '/'+ self.currentObj.Name);
			};

			NavListController.prototype.drillDown = function (subLevel) {
				var self = this;
				self.currentObj.Level = self.currentObj.Level + 1; 
				self.currentObj.Name = subLevel.Name; 
				self.currentObj.NodeID = subLevel.NodeID;
			}

			NavListController.prototype.getValues = function (nodes, level) {
				var self = this;
				var tempArr = [];
				_.forEach(nodes, function (node){
					if ((node.ChildNode.length === 0 && node.Keywords.length > 0) || node.ChildNode.length > 0){

						tempArr.push({ Name: node.Name.trim(), NodeID: node.NodeID, Level: level, Parent: node.ParentNodeID });
						if (level > __maxLevel){
							__maxLevel = level;
						}
						if (node.ChildNode.length > 0){
							var childNodeValue = self.getValues(node.ChildNode, ++level);
							if (!childNodeValue){
								tempArr.pop();
							}
							--level;
						}
					}
				});
				if (tempArr.length === 0){
					return false;
				}
				if (__startingLevel < __maxLevel){
					__startingLevel = adjustLevelArray(self.arrCategory, __startingLevel, __maxLevel);
				}
				self.arrCategory[level] = self.arrCategory[level].concat(tempArr);
				return true;
			};
			navApp.controller('NavListController', NavListController);

			// navApp.config(function($locationProvider) {
			// 	$locationProvider.html5Mode(true).hashPrefix('!');
			// })

			navApp.filter('unsafe', function($sce) {
				return function(val) {
					return $sce.trustAsHtml(val);
				};
			});

		})();

		var adjustLevelArray = function (arr, start, end) {
			for (var x = start; x <= end; x++){
				arr[x] = [];
			}
			return end;
		}


		</script>
		<style type="text/css">
		/****

		For NAV Example

		****/

		/*
		 *
		 * Updated NAV
		 *
		 */
		 a:visited, a:active, a:focus, a:hover {
		 	text-decoration: none;
		 	outline: 0;
		 }
		 .center {
		 	text-align: center;
		}
		 #hor-menu {
		 	width: 100%;
		 	background: #fff;
		 	border-bottom: 1px solid #000000;
		 }
		 .header {
		 	background-color: #000000;
		 }
		 .header {
		 	min-height: 50px;
		 	z-index: 1000;
		 	border-radius: 0;
		 	border: 0;
		 	margin: 0;
		 }
		/*.top-nav {
		  width: 100%;
		  background-color: #000000;
		  position: fixed;
		  }*/
		  header .bottom-nav {
		  	background: #ccc;
		  	position: relative;
		  }
		  .header .navbar-nav {
		  	margin: 0;
		  }
		  .header .brand .navbar-brand {
		  	font-size: 14px;
		  	font-weight: 600;
		  	padding-top: 0;
		  	padding-bottom: 0;
		  	line-height: 50px;
		  }
		  .header .brand .navbar-brand img {
		  	max-height: 25px;
		  	margin-right: 5px;
		  	margin-top: -5px;
		  }
		  .header .nav>li>a:hover, 
		  .header .nav>li>a:focus, 
		  .header .nav .open>a, 
		  .header .nav .open>a:hover, 
		  .header .nav .open>a:focus {
		  	background-color: #e4e4e4;
		  }
		  #utilnav {
		  	display: inline-block;
		  	padding: 0 10px;
		  }
		  #utilnav ul {
		  	list-style: none;
		  	color: #4076bb;
		  	font-size: 11px;
		  	font-weight: bold;
		  	line-height: 48px;
		  	white-space: nowrap;
		  	margin: 0 auto;
		  	padding: 0;
		  	font-family: arial, sans-serif;
		  }
		  #utilnav ul li {
		  	display: inline;
		  	margin: 0;
		  	padding: 0 7px 0 9px;
		  	border-left: 1px solid #fff;
		  }
		  #utilnav ul li:first-child {
		  	padding: 0 7px 0 0;
		  	border: 0;
		  }
		  #utilnav ul li a {
		  	color: #fff;
		  	text-decoration: none;
		  }
		  #utilnav ul li span.greeting {
		  	margin-right: 12px;
		  	color: #70a0eb;
		  }
		  .navbar {
		  	margin-bottom: 0;
		  	border-radius: 0;
		  	position: relative;
		  	top: 0;
		  	width: 100%;
		  	z-index: 1001;
		  	margin: -1px;
		  }
		  .nav>li>a:hover,
		  .nav>li>a:focus {
		  	background-color: transparent;
		  	/*color: #fff;*/
		  }
		  .nav>li {
		  	margin: 0;
		  }
		  #sidebar-wrapper {
		  	background: #252A31;
		  }
		  .filter-menu {
		  	position: fixed;
		  	z-index: 10;
		  }
		  #menu-container {
		  	position: fixed;
		  	z-index: 1001;
		  }
		  @media (max-width: 767px) {
		  	.header {
		  		width: 100%;
		  	}
		  	.layout, .header {
		  		-webkit-backface-visibility: hidden;
		  		position: relative;
		  		width: 100%;
		  		-webkit-transition: -webkit-transform 300ms ease 0s;
		  		transition: transform 300ms ease 0s;
		  	}
		  	.header.header-fixed {
		  		position: fixed;
		  		width: 100%;
		  		top: 0;
		  	}
		  	.header>.brand {
		  		width: 100%;
		  		text-align: center;
		  	}
		  	.header .brand .navbar-brand {
		  		display: inline-block;
		  		float: none;
		  		text-align: center;
		  	}
		  	.header .brand .navbar-brand {
				/*padding-top: 4px;
				line-height: 29px;*/
			}
			.header .off-left {
				position: absolute;
				left: 0;
				top: 0;
			}
			.header .navbar-toggle, 
			.header .brand [data-toggle="offscreen"] {
				z-index: 999;
				padding: 10px 15px;
				margin-top: 8px;
				margin-right: 0;
				margin-left: 0;
				margin-bottom: 8px;
				background-color: transparent;
				background-image: none;
				border: 1px solid transparent;
				border-radius: 2px;
			}
			.header .navbar-collapse {
				width: 100%;
			}
			.navbar-collapse {
				padding-left: 0px;
			}
			#utilnav ul {
				line-height: 12px;
			}
		}
		@media (max-width: 319px) {
			#utilnav {
				width: 100%;
				padding: 0;
			}
			#utilnav ul li:first-child {
				padding: 0 0 4% 0;
				border: 0;
			}
			.header .brand .navbar-brand {
				padding: 4px 0 0 0;
				line-height: 29px;
			}
		}
		@media (max-width: 238px) {
			#utilnav ul li {
				display: block;
				margin: 0;
				padding: 0 7px 0 9px;
				border-left: none;
			}
		}
		@media screen and (min-width: 768px) {
			
		}
		/****

		NEW Example CSS

		****/
		a {
			cursor: pointer;
		}
		.breadcrumb {
  			background: transparent;
  			padding: 0;
		}
		.breadcrumb>li.current {
			display: block;
		}
		.breadcrumb>li.current:before {
			display: none;
		}
		.breadcrumb>li+li:before {
			padding: 0 0 0 5px;
			content: "\f105\00a0";
			font-family: FontAwesome;
		}
		.browse-item a {
			padding: 2px 5px;
			display: block;
			font-size: 12px;
			font-weight: bold;
}		
		.browse-item a:hover {
			background-color: #D8ECFD;
		}
		.current {
			font-weight: bold;
		}
		.defaultBc,
		.current {
  			font-size: 22px;
  			font-weight: bold;
		}
		.main-content .content-wrap .wrapper {
  			padding: 15px;
		}
		/*
		 *
		 * Margin & Padding Options
		 *
		 *
		 */
		.no-m {
			margin: 0!important;
		}
		.mn {
			margin-right: -15px;
			margin-left: -15px;
		}
		.mrn {
			margin-right: -15px;
		}
		.mln {
			margin-left: -15px;
		}
		.mbn {
			margin-bottom: -15px;
		}
		.ml0 {
			margin-left: 0;
		}
		.mr0 {
			margin-right: 0;
		}
		.mt0 {
			margin-top: 0;
		}
		.mb0 {
			margin-bottom: 0;
		}
		.m25 {
			margin: 25px;
		}
		.mr25 {
			margin-right: 25px;
		}
		.ml25 {
			margin-left: 25px;
		}
		.mt25 {
			margin-top: 25px;
		}
		.mb25 {
			margin-bottom: 25px;
		}
		.m20 {
			margin: 20px;
		}
		.mr20 {
			margin-right: 20px;
		}
		.ml20 {
			margin-left: 20px;
		}
		.mt20 {
			margin-top: 20px;
		}
		.mb20 {
			margin-bottom: 20px;
		}
		.m15 {
			margin: 15px;
		}
		.mr15 {
			margin-right: 15px;
		}
		.ml15 {
			margin-left: 15px;
		}
		.mt15 {
			margin-top: 15px;
		}
		.mb15 {
			margin-bottom: 15px;
		}
		.m10 {
			margin: 10px;
		}
		.mr10 {
			margin-right: 10px;
		}
		.ml10 {
			margin-left: 10px;
		}
		.mt10 {
			margin-top: 10px;
		}
		.mb10 {
			margin-bottom: 10px;
		}
		.m5 {
			margin: 5px;
		}
		.mr5 {
			margin-right: 5px;
		}
		.ml5 {
			margin-left: 5px;
		}
		.mt5 {
			margin-top: 5px;
		}
		.mb5 {
			margin-bottom: 5px;
		}
		.no-p {
			padding: 0!important;
		}
		.pl0 {
			padding-left: 0;
		}
		.pr0 {
			padding-right: 0;
		}
		.pt0 {
			padding-top: 0;
		}
		.pb0 {
			padding-bottom: 0;
		}
		.p25 {
			padding: 25px;
		}
		.pr25 {
			padding-right: 25px;
		}
		.pl25 {
			padding-left: 25px;
		}
		.pt25 {
			padding-top: 25px;
		}
		.pb25 {
			padding-bottom: 25px;
		}
		.p20 {
			padding: 20px;
		}
		.pr20 {
			padding-right: 20px;
		}
		.pl20 {
			padding-left: 20px;
		}
		.pt20 {
			padding-top: 20px;
		}
		.pb20 {
			padding-bottom: 20px;
		}
		.p15 {
			padding: 15px;
		}
		.pr15 {
			padding-right: 15px;
		}
		.pl15 {
			padding-left: 15px;
		}
		.pt15 {
			padding-top: 15px;
		}
		.pb15 {
			padding-bottom: 15px;
		}
		.p10 {
			padding: 10px;
		}
		.pr10 {
			padding-right: 10px;
		}
		.pl10 {
			padding-left: 10px;
		}
		.pt10 {
			padding-top: 10px;
		}
		.pb10 {
			padding-bottom: 10px;
		}
		.p5 {
			padding: 5px;
		}
		.pr5 {
			padding-right: 5px;
		}
		.pl5 {
			padding-left: 5px;
		}
		.pt5 {
			padding-top: 5px;
		}
		.pb5 {
			padding-bottom: 5px;
		}

		@media (max-width: 1960px) {

		}

		@media (max-width: 833px) {
		}

		@media (max-width: 768px) {
			.breadcrumb {
				text-align: center;
			}
			.breadcrumb>li.current,
			#browse-nav {
				text-align: center;
			}
		}
		@media (max-width: 480px) {
			
		}
		</style>
	</head>
	<body ng-controller="NavListController as navListCtrl">

		<header class="header navbar">
			<div class="container">
				<div class="brand top-nav">
					<div class="navbar-brand">
						<a href="javascript:;" class="ti-menu navbar-toggle off-left visible-xs collapsed" data-toggle="collapse" data-target="#hor-menu"></a>
						<a href="#" class=" navbar-nav">
							<img src="http://92Y.org/_ui/uptown/img/sitelogo_92Y.png" alt=""/>
						</a>
						<div id="utilnav" role="navigation">
							<ul>
								<li><span class="greeting">Howdy!</span>
									<a id="link_loginLogout" href="/account/logout.aspx">Log Out</a>
								</li>
								<li> <a id="link_changeLogin" href="/account/accountupdate.aspx">My Account</a>
								</li>
							</ul>
						</div>
					</div>
				</div>
			</div>
			<div class="navbar-collapse pull-left collapse" id="hor-menu">
				<div class="container no-p">
					<ul class="nav navbar-nav">
						<li class="dropdown">
							<a href="javascript:;" data-toggle="dropdown">
								<span id="advancedFilters" class="mainNavHighlight">Find Programs &amp; Classes</span>
								<!-- <b class="caret"></b> -->
							</a>
						</li>
						<li class="dropdown">
							<a href="javascript:;">
								<span>Talks &amp; Readings</span>
							</a>
						</li>
						<li class="dropdown">
							<a href="javascript:;">
								<span>Performing Arts</span>
							</a>
						</li>
						<li class="dropdown">
							<a href="javascript:;">
								<span>School of the Arts</span>
							</a>
						</li>
						<li class="dropdown">
							<a href="javascript:;">
								<span>Health &amp; Fitness</span>
							</a>
						</li>
						<li class="dropdown">
							<a href="javascript:;">
								<span>Jewish Life</span>
							</a>
						</li>
						<li class="dropdown">
							<a href="javascript:;">
								<span>Kids &amp; Family</span>
							</a>
						</li>
					</ul>
				</div>
			</div>
		</header>
		<section class="main-content">
			<div class="content-wrap">
				<div class="wrapper">
					<div class="row">
						<section class="filter-content">
							<div id="filter-container" class="container">
								<section id="breadcrumb-content" class="col-xs-12 col-sm-5 col-md-5 no-p">
									<ol class="breadcrumb">
										<li class="" ng-class="{'defaultBc': navListCtrl.activeBreadcrumb.length === 1, 'current': $last && navListCtrl.activeBreadcrumb.length > 1, 'bcChain': $middle}" 
											ng-repeat="bc in navListCtrl.activeBreadcrumb" ng-bind-html="bc.Name | unsafe"></li>
									</ol>
								</section>
								<section id="browse-nav" class="col-xs-12 col-sm-7 col-md-7 col-md-pull-0 no-p">
									<span class="">
										<span class="browse-item col-xs-12 col-sm-6 col-md-4" ng-repeat="sl in navListCtrl.arrCategory[navListCtrl.currentObj.Level+1] | filter: { Parent: navListCtrl.currentObj.NodeID }">
											<a ng-click="navListCtrl.drillDown(sl); navListCtrl.setUrl();" ng-bind-html="sl.Name | unsafe"></a>
										</span>
									</span>
								</section>
							</div>
						</section>
					</div>
				</div>
			</div>
		</section>

	</body>
</html>